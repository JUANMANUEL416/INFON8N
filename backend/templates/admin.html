<!doctype html>
<html lang="es">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Panel de AdministraciÃ³n - Reportes</title>
    <link rel="stylesheet" href="/static/admin.css?v=2" />
  </head>
  <body>
    <div class="admin-container">
      <nav class="sidebar">
        <div class="logo">
          <h2>ğŸ”§ Admin Panel</h2>
        </div>
        <ul class="menu">
          <li class="active" data-section="reportes">
            <span>ğŸ“Š</span> GestiÃ³n de Reportes
          </li>
          <li data-section="datos"><span>ğŸ’¾</span> Ver Datos</li>
          <li data-section="usuarios"><span>ğŸ‘¥</span> Usuarios</li>
        </ul>
        <div class="user-info">
          <p>ğŸ‘¤ Administrador</p>
          <a href="/">â† Portal Usuario</a>
        </div>
      </nav>

      <main class="content">
        <!-- SecciÃ³n: GestiÃ³n de Reportes -->
        <section id="reportes-section" class="section active">
          <header class="section-header">
            <h1>ğŸ“Š GestiÃ³n de Reportes</h1>
            <button class="btn btn-primary" onclick="abrirModalNuevoReporte()">
              + Crear Nuevo Reporte
            </button>
          </header>

          <div id="reportes-grid" class="reportes-grid">
            <!-- Los reportes se cargan aquÃ­ dinÃ¡micamente -->
          </div>
        </section>

        <!-- SecciÃ³n: Ver Datos -->
        <section id="datos-section" class="section">
          <header class="section-header">
            <h1>ğŸ’¾ Datos Cargados</h1>
          </header>
          <div id="datos-content">
            <p>Selecciona un reporte en la secciÃ³n anterior</p>
          </div>
        </section>

        <!-- SecciÃ³n: Usuarios -->
        <section id="usuarios-section" class="section">
          <header class="section-header">
            <h1>ğŸ‘¥ GestiÃ³n de Usuarios</h1>
          </header>
          <p>En desarrollo...</p>
        </section>
      </main>
    </div>

    <!-- Modal: Nuevo Reporte -->
    <div id="modal-nuevo-reporte" class="modal">
      <div class="modal-content">
        <div class="modal-header">
          <h2>Crear Nuevo Reporte</h2>
          <button class="close-btn" onclick="cerrarModal()">&times;</button>
        </div>

        <div class="modal-body">
          <form id="form-nuevo-reporte">
            <!-- InformaciÃ³n BÃ¡sica -->
            <div class="form-section">
              <h3>ğŸ“ InformaciÃ³n BÃ¡sica</h3>

              <div class="form-group">
                <label>Nombre del Reporte *</label>
                <input
                  type="text"
                  name="nombre"
                  required
                  placeholder="Ej: FacturaciÃ³n Diaria"
                />
              </div>

              <div class="form-group">
                <label>CÃ³digo (sin espacios) *</label>
                <input
                  type="text"
                  name="codigo"
                  required
                  placeholder="Ej: facturacion_diaria"
                />
                <small
                  >Este cÃ³digo serÃ¡ usado internamente. No se puede cambiar
                  despuÃ©s.</small
                >
              </div>

              <div class="form-row">
                <div class="form-group">
                  <label>CategorÃ­a</label>
                  <select name="categoria">
                    <option value="finanzas">Finanzas</option>
                    <option value="ventas">Ventas</option>
                    <option value="operaciones">Operaciones</option>
                    <option value="rrhh">Recursos Humanos</option>
                    <option value="otros">Otros</option>
                  </select>
                </div>

                <div class="form-group">
                  <label>Icono (emoji)</label>
                  <input type="text" name="icono" value="ğŸ“Š" maxlength="2" />
                </div>
              </div>

              <div class="form-group">
                <label>DescripciÃ³n</label>
                <textarea
                  name="descripcion"
                  rows="2"
                  placeholder="Breve descripciÃ³n del reporte"
                ></textarea>
              </div>

              <div class="form-group">
                <label>Contexto (para IA) *</label>
                <textarea
                  name="contexto"
                  rows="4"
                  required
                  placeholder="Describe el propÃ³sito del reporte, quÃ© informaciÃ³n contiene, cÃ³mo se relaciona con otros datos, y cualquier consideraciÃ³n importante para anÃ¡lisis automÃ¡tico."
                ></textarea>
                <small
                  >Este contexto serÃ¡ usado por agentes de IA para entender y
                  analizar los datos correctamente.</small
                >
              </div>
            </div>

            <!-- Campos -->
            <div class="form-section">
              <h3>ğŸ“‹ Campos del Reporte</h3>
              <p>Define las columnas que tendrÃ¡ el archivo Excel</p>

              <!-- NUEVO: OpciÃ³n de subir Excel -->
              <div class="excel-upload-section">
                <div class="upload-option">
                  <h4>âš¡ OpciÃ³n RÃ¡pida: Subir Excel de Ejemplo</h4>
                  <p>
                    Sube un archivo Excel con los encabezados y una fila de
                    ejemplo para detectar automÃ¡ticamente los campos
                  </p>

                  <div class="excel-dropzone" id="excel-dropzone">
                    <span class="upload-icon">ğŸ“</span>
                    <p>Arrastra tu Excel aquÃ­ o haz clic para seleccionar</p>
                    <small
                      >El archivo debe tener los encabezados y al menos una fila
                      con datos de ejemplo</small
                    >
                  </div>
                  <input
                    type="file"
                    id="excel-input"
                    accept=".xlsx"
                    style="display: none"
                  />

                  <div
                    id="excel-result"
                    class="excel-result"
                    style="display: none"
                  >
                    <p class="success-msg">âœ… <span id="excel-msg"></span></p>
                    <button
                      type="button"
                      class="btn btn-secondary btn-sm"
                      onclick="limpiarExcel()"
                    >
                      Limpiar y agregar manualmente
                    </button>
                  </div>
                </div>

                <div class="divider">
                  <span>O</span>
                </div>

                <div class="manual-option">
                  <h4>âœï¸ Agregar Campos Manualmente</h4>
                </div>
              </div>

              <div id="campos-container">
                <!-- Los campos se agregan dinÃ¡micamente -->
              </div>

              <button
                type="button"
                class="btn btn-secondary"
                onclick="agregarCampo()"
              >
                + Agregar Campo
              </button>
            </div>

            <!-- Relaciones -->
            <div class="form-section">
              <h3>ğŸ”— Relaciones (opcional)</h3>
              <p>Define cÃ³mo este reporte se relaciona con otros</p>

              <div id="relaciones-container">
                <!-- Las relaciones se agregan dinÃ¡micamente -->
              </div>

              <button
                type="button"
                class="btn btn-secondary"
                onclick="agregarRelacion()"
              >
                + Agregar RelaciÃ³n
              </button>
            </div>

            <div class="form-actions">
              <button
                type="button"
                class="btn btn-secondary"
                onclick="cerrarModal()"
              >
                Cancelar
              </button>
              <button type="submit" class="btn btn-success">
                ğŸ’¾ Guardar Reporte
              </button>
            </div>
          </form>
        </div>
      </div>
    </div>

    <!-- Modal: Editar Reporte -->
    <div id="modal-editar-reporte" class="modal">
      <div class="modal-content">
        <div class="modal-header">
          <h2>Editar Reporte</h2>
          <button class="close-btn" onclick="cerrarModalEditar()">
            &times;
          </button>
        </div>
        <div class="modal-body">
          <form id="form-editar-reporte">
            <!-- Similar al formulario de crear -->
            <div id="editar-content"></div>
          </form>
        </div>
      </div>
    </div>

    <script src="/static/admin.js"></script>
  </body>
</html>
