<!doctype html>
<html lang="es">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Panel de Administraci√≥n - Reportes</title>
    <link rel="stylesheet" href="/static/admin.css?v=2" />
    <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.1/dist/chart.umd.min.js"></script>
  </head>
  <body>
    <div class="admin-container">
      <nav class="sidebar">
        <div class="logo">
          <h2>üîß Admin Panel</h2>
        </div>
        <ul class="menu">
          <li class="active" data-section="reportes">
            <span>üìä</span> Gesti√≥n de Reportes
          </li>
          <li data-section="datos"><span>üíæ</span> Ver Datos</li>
          <li data-section="analisis"><span>ü§ñ</span> An√°lisis IA</li>
          <li data-section="aclaraciones">
            <span>üí≠</span> Aclaraciones
            <span
              id="badge-aclaraciones"
              class="badge-notif"
              style="display: none"
              >0</span
            >
          </li>
          <li data-section="usuarios"><span>üë•</span> Usuarios</li>
        </ul>
        <div class="user-info">
          <p>üë§ Administrador</p>
          <a href="/">‚Üê Portal Usuario</a>
          <button
            onclick="cerrarSesion()"
            style="
              margin-top: 10px;
              width: 100%;
              padding: 8px;
              background: #dc3545;
              color: white;
              border: none;
              border-radius: 4px;
              cursor: pointer;
            "
          >
            üö™ Cerrar Sesi√≥n
          </button>
        </div>
      </nav>

      <main class="content">
        <!-- Secci√≥n: Gesti√≥n de Reportes -->
        <section id="reportes-section" class="section active">
          <header class="section-header">
            <h1>üìä Gesti√≥n de Reportes</h1>
            <button class="btn btn-primary" onclick="abrirModalNuevoReporte()">
              + Crear Nuevo Reporte
            </button>
          </header>

          <div id="reportes-grid" class="reportes-grid">
            <!-- Los reportes se cargan aqu√≠ din√°micamente -->
          </div>
        </section>

        <!-- Secci√≥n: Ver Datos -->
        <section id="datos-section" class="section">
          <header class="section-header">
            <h1>üíæ Consultar Datos</h1>
          </header>

          <div class="card" style="margin-bottom: 20px">
            <h3>Seleccionar Reporte</h3>
            <select
              id="select-reporte-datos"
              class="form-control"
              onchange="cargarDatosReporte()"
            >
              <option value="">-- Seleccione un reporte --</option>
            </select>

            <div id="filtros-consulta" style="display: none; margin-top: 20px">
              <h3>Filtros</h3>
              <div
                style="
                  display: grid;
                  grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
                  gap: 15px;
                "
              >
                <div>
                  <label>L√≠mite de registros:</label>
                  <select id="limite-registros" class="form-control">
                    <option value="50">50 registros</option>
                    <option value="100" selected>100 registros</option>
                    <option value="500">500 registros</option>
                    <option value="1000">1000 registros</option>
                  </select>
                </div>
                <div>
                  <label>Fecha desde:</label>
                  <input type="date" id="fecha-desde" class="form-control" />
                </div>
                <div>
                  <label>Fecha hasta:</label>
                  <input type="date" id="fecha-hasta" class="form-control" />
                </div>
              </div>
              <div style="margin-top: 15px">
                <button class="btn btn-primary" onclick="buscarDatos()">
                  üîç Buscar
                </button>
                <button class="btn btn-success" onclick="exportarDatos()">
                  üì• Exportar a Excel
                </button>
                <button class="btn btn-info" onclick="mostrarWebhookInfo()">
                  üîó Webhook n8n
                </button>
              </div>
            </div>
          </div>

          <div id="datos-content">
            <div
              id="datos-estadisticas"
              style="display: none; margin-bottom: 20px"
            >
              <div
                style="
                  display: grid;
                  grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
                  gap: 15px;
                "
              >
                <div class="stat-card">
                  <h4>Total Registros</h4>
                  <p
                    id="stat-total"
                    style="font-size: 2rem; font-weight: bold; color: #667eea"
                  >
                    0
                  </p>
                </div>
                <div class="stat-card">
                  <h4>√öltima Actualizaci√≥n</h4>
                  <p id="stat-fecha" style="font-size: 1rem; color: #666">-</p>
                </div>
              </div>
            </div>

            <div id="datos-tabla-container" style="overflow-x: auto">
              <p style="color: #999; text-align: center; padding: 40px">
                Seleccione un reporte para ver los datos
              </p>
            </div>
          </div>
        </section>

        <!-- Secci√≥n: An√°lisis IA -->
        <section id="analisis-section" class="section">
          <header class="section-header">
            <h1>ü§ñ An√°lisis con IA y Chat</h1>
          </header>

          <div class="card" style="margin-bottom: 20px">
            <h3>Seleccionar Reporte</h3>
            <select
              id="select-reporte-analisis"
              class="form-control"
              onchange="cargarReporteAnalisis()"
            >
              <option value="">-- Seleccione un reporte --</option>
            </select>
          </div>

          <div id="analisis-container" style="display: none">
            <!-- Tabs de An√°lisis -->
            <div class="tabs">
              <button
                class="tab-btn active"
                onclick="cambiarTabAnalisis('chat')"
              >
                üí¨ Chat con IA
              </button>
              <button class="tab-btn" onclick="cambiarTabAnalisis('informes')">
                üìë Generar Informes
              </button>
              <button class="tab-btn" onclick="cambiarTabAnalisis('busqueda')">
                üîç B√∫squeda Sem√°ntica
              </button>
            </div>

            <!-- Tab: Chat -->
            <div
              id="tab-chat-ia"
              class="tab-content active"
              style="margin-top: 20px"
            >
              <div
                class="chat-container"
                style="background: #f9f9f9; border-radius: 10px; padding: 20px"
              >
                <div
                  id="chat-messages"
                  style="
                    height: 400px;
                    overflow-y: auto;
                    margin-bottom: 15px;
                    background: white;
                    padding: 15px;
                    border-radius: 8px;
                  "
                >
                  <div class="chat-message system">
                    <strong>ü§ñ Asistente IA:</strong>
                    <p>
                      Hola! Estoy listo para ayudarte a analizar tus datos.
                      Puedes hacerme preguntas como:
                    </p>
                    <ul>
                      <li>"¬øCu√°l es el total facturado?"</li>
                      <li>"¬øQu√© clientes tienen mayor facturaci√≥n?"</li>
                      <li>"¬øCu√°les son las tendencias del mes?"</li>
                      <li>"Mu√©strame anomal√≠as en los datos"</li>
                    </ul>
                  </div>
                </div>

                <div style="display: flex; gap: 10px">
                  <input
                    type="text"
                    id="chat-input"
                    class="form-control"
                    placeholder="Escribe tu pregunta aqu√≠..."
                    onkeypress="if (event.key === 'Enter') enviarPregunta();"
                    style="flex: 1"
                  />
                  <button class="btn btn-primary" onclick="enviarPregunta()">
                    Enviar
                  </button>
                </div>

                <div style="margin-top: 10px; font-size: 0.9em; color: #666">
                  üí° Tip: Primero indexa los datos para respuestas m√°s precisas
                  <button
                    class="btn btn-sm btn-info"
                    onclick="indexarDatos()"
                    style="margin-left: 10px"
                  >
                    üîÑ Indexar Datos
                  </button>
                  <span id="indexar-status" style="margin-left: 10px"></span>
                </div>
              </div>
            </div>

            <!-- Tab: Informes -->
            <div
              id="tab-informes-ia"
              class="tab-content"
              style="margin-top: 20px"
            >
              <div class="card">
                <h3>Generar Informes con IA</h3>
                <p>Selecciona el tipo de informe que deseas generar:</p>

                <div
                  style="
                    display: grid;
                    grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
                    gap: 15px;
                    margin-top: 20px;
                  "
                >
                  <button
                    class="btn btn-primary"
                    onclick="generarAnalisis('general')"
                  >
                    üìä An√°lisis General
                  </button>
                  <button
                    class="btn btn-info"
                    onclick="generarAnalisis('tendencias')"
                  >
                    üìà An√°lisis de Tendencias
                  </button>
                  <button
                    class="btn btn-warning"
                    onclick="generarAnalisis('anomalias')"
                  >
                    ‚ö†Ô∏è Detectar Anomal√≠as
                  </button>
                  <button
                    class="btn btn-success"
                    onclick="generarInformeCompleto()"
                  >
                    üìë Informe Completo
                  </button>
                </div>

                <div
                  id="informe-resultado"
                  style="margin-top: 30px; display: none"
                >
                  <h3 id="informe-titulo">Resultado</h3>

                  <!-- Contenedor de gr√°ficos -->
                  <div
                    id="graficos-container"
                    style="
                      display: grid;
                      grid-template-columns: repeat(
                        auto-fit,
                        minmax(400px, 1fr)
                      );
                      gap: 20px;
                      margin-bottom: 30px;
                    "
                  ></div>

                  <!-- Contenido del an√°lisis de texto -->
                  <div
                    id="informe-contenido"
                    style="
                      background: #f9f9f9;
                      padding: 20px;
                      border-radius: 8px;
                      white-space: pre-wrap;
                      line-height: 1.6;
                    "
                  ></div>

                  <button
                    class="btn btn-secondary"
                    onclick="copiarInforme()"
                    style="margin-top: 15px"
                  >
                    üìã Copiar Informe
                  </button>
                </div>
              </div>
            </div>

            <!-- Tab: B√∫squeda Sem√°ntica -->
            <div
              id="tab-busqueda-ia"
              class="tab-content"
              style="margin-top: 20px"
            >
              <div class="card">
                <h3>B√∫squeda Sem√°ntica en los Datos</h3>
                <p>
                  Busca informaci√≥n usando lenguaje natural. El sistema
                  encuentra los registros m√°s relevantes.
                </p>

                <div style="margin-top: 20px">
                  <label>¬øQu√© est√°s buscando?</label>
                  <textarea
                    id="busqueda-input"
                    class="form-control"
                    rows="3"
                    placeholder="Ejemplo: Busca facturas de m√°s de 1 mill√≥n de pesos del cliente Universidad"
                  ></textarea>

                  <div style="margin-top: 15px">
                    <label>N√∫mero de resultados:</label>
                    <select
                      id="busqueda-limite"
                      class="form-control"
                      style="width: 200px"
                    >
                      <option value="3">3 resultados</option>
                      <option value="5" selected>5 resultados</option>
                      <option value="10">10 resultados</option>
                      <option value="20">20 resultados</option>
                    </select>
                  </div>

                  <button
                    class="btn btn-primary"
                    onclick="buscarSemantico()"
                    style="margin-top: 15px"
                  >
                    üîç Buscar
                  </button>
                </div>

                <div
                  id="busqueda-resultados"
                  style="margin-top: 30px; display: none"
                >
                  <h3>Resultados Encontrados</h3>
                  <div id="busqueda-contenido"></div>
                </div>
              </div>
            </div>
          </div>
        </section>

        <!-- Secci√≥n: Aclaraciones y Validaciones IA -->
        <section id="aclaraciones-section" class="section">
          <header class="section-header">
            <h1>üí≠ Aclaraciones y Validaciones IA</h1>
            <button class="btn btn-info" onclick="cargarAclaraciones()">
              üîÑ Actualizar
            </button>
          </header>

          <div class="stats-cards" style="margin-bottom: 20px">
            <div class="stat-card">
              <h3>Pendientes de Usuario</h3>
              <div class="stat-value" id="stat-aclaraciones-pendientes">0</div>
            </div>
            <div class="stat-card">
              <h3>Pendientes de Validaci√≥n</h3>
              <div class="stat-value" id="stat-aclaraciones-validacion">0</div>
            </div>
            <div class="stat-card">
              <h3>Aprobadas Hoy</h3>
              <div class="stat-value" id="stat-aclaraciones-aprobadas">0</div>
            </div>
          </div>

          <!-- Tabs de Aclaraciones -->
          <div class="tabs">
            <button
              class="tab-btn active"
              onclick="cambiarTabAclaraciones('pendientes')"
            >
              ‚è≥ Pendientes de Respuesta
            </button>
            <button
              class="tab-btn"
              onclick="cambiarTabAclaraciones('validacion')"
            >
              ‚úÖ Requieren Validaci√≥n Admin
            </button>
            <button
              class="tab-btn"
              onclick="cambiarTabAclaraciones('aprobadas')"
            >
              üìö Base de Conocimiento
            </button>
          </div>

          <!-- Tab: Pendientes de Respuesta -->
          <div
            id="tab-aclaraciones-pendientes"
            class="tab-content active"
            style="margin-top: 20px"
          >
            <div id="lista-aclaraciones-pendientes">
              <p style="text-align: center; color: #666">
                Cargando aclaraciones...
              </p>
            </div>
          </div>

          <!-- Tab: Requieren Validaci√≥n Admin -->
          <div
            id="tab-aclaraciones-validacion"
            class="tab-content"
            style="margin-top: 20px"
          >
            <div id="lista-aclaraciones-validacion">
              <p style="text-align: center; color: #666">
                Cargando aclaraciones para validar...
              </p>
            </div>
          </div>

          <!-- Tab: Base de Conocimiento -->
          <div
            id="tab-aclaraciones-aprobadas"
            class="tab-content"
            style="margin-top: 20px"
          >
            <div id="lista-base-conocimiento">
              <p style="text-align: center; color: #666">
                Cargando base de conocimiento...
              </p>
            </div>
          </div>
        </section>

        <!-- Secci√≥n: Usuarios -->
        <section id="usuarios-section" class="section">
          <header class="section-header">
            <h1>üë• Gesti√≥n de Usuarios y Grupos</h1>
            <div>
              <button
                class="btn btn-primary"
                onclick="abrirModalNuevoUsuario()"
              >
                + Nuevo Usuario
              </button>
              <button
                class="btn btn-secondary"
                onclick="abrirModalNuevoGrupo()"
              >
                + Nuevo Grupo
              </button>
            </div>
          </header>

          <div class="tabs">
            <button class="tab-btn active" onclick="cambiarTab('usuarios')">
              Usuarios
            </button>
            <button class="tab-btn" onclick="cambiarTab('grupos')">
              Grupos
            </button>
            <button class="tab-btn" onclick="cambiarTab('permisos')">
              Permisos
            </button>
          </div>

          <div id="tab-usuarios" class="tab-content active">
            <table class="data-table">
              <thead>
                <tr>
                  <th>Usuario</th>
                  <th>Nombre</th>
                  <th>Grupo</th>
                  <th>Estado</th>
                  <th>Fecha Creaci√≥n</th>
                  <th>Acciones</th>
                </tr>
              </thead>
              <tbody id="usuarios-list">
                <tr>
                  <td colspan="6">Cargando...</td>
                </tr>
              </tbody>
            </table>
          </div>

          <div id="tab-grupos" class="tab-content">
            <table class="data-table">
              <thead>
                <tr>
                  <th>C√≥digo</th>
                  <th>Nombre</th>
                  <th>Descripci√≥n</th>
                  <th>Usuarios</th>
                  <th>Estado</th>
                  <th>Acciones</th>
                </tr>
              </thead>
              <tbody id="grupos-list">
                <tr>
                  <td colspan="6">Cargando...</td>
                </tr>
              </tbody>
            </table>
          </div>

          <div id="tab-permisos" class="tab-content">
            <div class="permisos-container">
              <div class="form-group">
                <label>Seleccionar Grupo:</label>
                <select
                  id="grupo-permisos-select"
                  onchange="cargarPermisosGrupo()"
                >
                  <option value="">Seleccione un grupo...</option>
                </select>
              </div>
              <div id="permisos-grid"></div>
            </div>
          </div>
        </section>
      </main>
    </div>

    <!-- Modal: Nuevo Reporte -->
    <div id="modal-nuevo-reporte" class="modal">
      <div class="modal-content">
        <div class="modal-header">
          <h2>Crear Nuevo Reporte</h2>
          <button class="close-btn" onclick="cerrarModal()">&times;</button>
        </div>

        <div class="modal-body">
          <form id="form-nuevo-reporte">
            <!-- Informaci√≥n B√°sica -->
            <div class="form-section">
              <h3>üìù Informaci√≥n B√°sica</h3>

              <div class="form-group">
                <label>Nombre del Reporte *</label>
                <input
                  type="text"
                  name="nombre"
                  required
                  placeholder="Ej: Facturaci√≥n Diaria"
                />
              </div>

              <div class="form-group">
                <label>C√≥digo (sin espacios) *</label>
                <input
                  type="text"
                  name="codigo"
                  required
                  placeholder="Ej: facturacion_diaria"
                />
                <small
                  >Este c√≥digo ser√° usado internamente. No se puede cambiar
                  despu√©s.</small
                >
              </div>

              <div class="form-row">
                <div class="form-group">
                  <label>Categor√≠a</label>
                  <select name="categoria">
                    <option value="finanzas">Finanzas</option>
                    <option value="ventas">Ventas</option>
                    <option value="operaciones">Operaciones</option>
                    <option value="rrhh">Recursos Humanos</option>
                    <option value="otros">Otros</option>
                  </select>
                </div>

                <div class="form-group">
                  <label>Icono (emoji)</label>
                  <input type="text" name="icono" value="üìä" maxlength="2" />
                </div>
              </div>

              <div class="form-group">
                <label>Descripci√≥n</label>
                <textarea
                  name="descripcion"
                  rows="2"
                  placeholder="Breve descripci√≥n del reporte"
                ></textarea>
              </div>

              <div class="form-group">
                <label>Contexto (para IA) *</label>
                <textarea
                  name="contexto"
                  rows="4"
                  required
                  placeholder="Describe el prop√≥sito del reporte, qu√© informaci√≥n contiene, c√≥mo se relaciona con otros datos, y cualquier consideraci√≥n importante para an√°lisis autom√°tico."
                ></textarea>
                <small
                  >Este contexto ser√° usado por agentes de IA para entender y
                  analizar los datos correctamente.</small
                >
              </div>
            </div>

            <!-- API y Consultas -->
            <div class="form-section">
              <h3>üîå API y Consultas</h3>
              <p>Configuraci√≥n para acceder a los datos mediante API</p>

              <div class="form-group">
                <label>Endpoint de API</label>
                <input
                  type="text"
                  name="api_endpoint"
                  placeholder="/api/query/facturacion_diaria"
                />
                <small
                  >Ruta personalizada para consultar este reporte. Si se deja
                  vac√≠o, se usar√°: /api/query/{codigo}</small
                >
              </div>

              <div class="form-group">
                <label>Plantilla de Consulta SQL (opcional)</label>
                <textarea
                  name="query_template"
                  rows="6"
                  placeholder="SELECT * FROM datos_reportes 
WHERE reporte_codigo = '{codigo}'
  AND datos->>'fecha' >= '{fecha_inicio}'
  AND datos->>'fecha' <= '{fecha_fin}'
ORDER BY created_at DESC
LIMIT {limite}"
                ></textarea>
                <small
                  >Puedes usar placeholders: {codigo}, {fecha_inicio},
                  {fecha_fin}, {limite}, {campo_*}. Si se deja vac√≠o, se usar√°
                  una consulta est√°ndar.</small
                >
              </div>
            </div>

            <!-- Campos -->
            <div class="form-section">
              <h3>üìã Campos del Reporte</h3>
              <p>Define las columnas que tendr√° el archivo Excel</p>

              <!-- NUEVO: Opci√≥n de subir Excel -->
              <div class="excel-upload-section">
                <div class="upload-option">
                  <h4>‚ö° Opci√≥n R√°pida: Subir Excel de Ejemplo</h4>
                  <p>
                    Sube un archivo Excel con los encabezados y una fila de
                    ejemplo para detectar autom√°ticamente los campos
                  </p>

                  <div class="excel-dropzone" id="excel-dropzone">
                    <span class="upload-icon">üìÅ</span>
                    <p>Arrastra tu Excel aqu√≠ o haz clic para seleccionar</p>
                    <small
                      >El archivo debe tener los encabezados y al menos una fila
                      con datos de ejemplo</small
                    >
                  </div>
                  <input
                    type="file"
                    id="excel-input"
                    accept=".xlsx"
                    style="display: none"
                  />

                  <div
                    id="excel-result"
                    class="excel-result"
                    style="display: none"
                  >
                    <p class="success-msg">‚úÖ <span id="excel-msg"></span></p>
                    <button
                      type="button"
                      class="btn btn-secondary btn-sm"
                      onclick="limpiarExcel()"
                    >
                      Limpiar y agregar manualmente
                    </button>
                  </div>
                </div>

                <div class="divider">
                  <span>O</span>
                </div>

                <div class="manual-option">
                  <h4>‚úçÔ∏è Agregar Campos Manualmente</h4>
                </div>
              </div>

              <div id="campos-container">
                <!-- Los campos se agregan din√°micamente -->
              </div>

              <button
                type="button"
                class="btn btn-secondary"
                onclick="agregarCampo()"
              >
                + Agregar Campo
              </button>
            </div>

            <!-- Relaciones -->
            <div class="form-section">
              <h3>üîó Relaciones (opcional)</h3>
              <p>Define c√≥mo este reporte se relaciona con otros</p>

              <div id="relaciones-container">
                <!-- Las relaciones se agregan din√°micamente -->
              </div>

              <button
                type="button"
                class="btn btn-secondary"
                onclick="agregarRelacion()"
              >
                + Agregar Relaci√≥n
              </button>
            </div>

            <div class="form-actions">
              <button
                type="button"
                class="btn btn-secondary"
                onclick="cerrarModal()"
              >
                Cancelar
              </button>
              <button type="submit" class="btn btn-success">
                üíæ Guardar Reporte
              </button>
            </div>
          </form>
        </div>
      </div>
    </div>

    <!-- Modal: Editar Reporte -->
    <div id="modal-editar-reporte" class="modal">
      <div class="modal-content">
        <div class="modal-header">
          <h2>Editar Reporte</h2>
          <button class="close-btn" onclick="cerrarModalEditar()">
            &times;
          </button>
        </div>
        <div class="modal-body">
          <form id="form-editar-reporte">
            <!-- Similar al formulario de crear -->
            <div id="editar-content"></div>
          </form>
        </div>
      </div>
    </div>

    <!-- Modal: Nuevo Usuario -->
    <div id="modal-nuevo-usuario" class="modal">
      <div class="modal-content">
        <div class="modal-header">
          <h2>Crear Nuevo Usuario</h2>
          <button class="close-btn" onclick="cerrarModalUsuario()">
            &times;
          </button>
        </div>
        <div class="modal-body">
          <form id="form-nuevo-usuario" onsubmit="guardarUsuario(event)">
            <div class="form-group">
              <label>Username *</label>
              <input
                type="text"
                name="username"
                required
                placeholder="Nombre de usuario √∫nico"
              />
            </div>
            <div class="form-group">
              <label>Contrase√±a *</label>
              <input
                type="password"
                name="password"
                required
                placeholder="Contrase√±a"
              />
            </div>
            <div class="form-group">
              <label>Nombre Completo *</label>
              <input
                type="text"
                name="nombre"
                required
                placeholder="Nombre completo del usuario"
              />
            </div>
            <div class="form-group">
              <label>Grupo *</label>
              <select name="grupo_id" id="usuario-grupo-select" required>
                <option value="">Seleccione un grupo...</option>
              </select>
            </div>
            <div class="form-group">
              <label>Estado</label>
              <select name="estado">
                <option value="activo">Activo</option>
                <option value="inactivo">Inactivo</option>
              </select>
            </div>
            <div class="modal-footer">
              <button
                type="button"
                class="btn btn-secondary"
                onclick="cerrarModalUsuario()"
              >
                Cancelar
              </button>
              <button type="submit" class="btn btn-primary">
                Guardar Usuario
              </button>
            </div>
          </form>
        </div>
      </div>
    </div>

    <!-- Modal: Nuevo Grupo -->
    <div id="modal-nuevo-grupo" class="modal">
      <div class="modal-content">
        <div class="modal-header">
          <h2>Crear Nuevo Grupo</h2>
          <button class="close-btn" onclick="cerrarModalGrupo()">
            &times;
          </button>
        </div>
        <div class="modal-body">
          <form id="form-nuevo-grupo" onsubmit="guardarGrupo(event)">
            <div class="form-group">
              <label>C√≥digo *</label>
              <input
                type="text"
                name="codigo"
                required
                placeholder="codigo_unico (sin espacios)"
              />
            </div>
            <div class="form-group">
              <label>Nombre *</label>
              <input
                type="text"
                name="nombre"
                required
                placeholder="Nombre del grupo"
              />
            </div>
            <div class="form-group">
              <label>Descripci√≥n</label>
              <textarea
                name="descripcion"
                rows="3"
                placeholder="Descripci√≥n del grupo"
              ></textarea>
            </div>
            <div class="form-group">
              <label>Estado</label>
              <select name="estado">
                <option value="activo">Activo</option>
                <option value="inactivo">Inactivo</option>
              </select>
            </div>
            <div class="modal-footer">
              <button
                type="button"
                class="btn btn-secondary"
                onclick="cerrarModalGrupo()"
              >
                Cancelar
              </button>
              <button type="submit" class="btn btn-primary">
                Guardar Grupo
              </button>
            </div>
          </form>
        </div>
      </div>
    </div>

    <!-- Modal: Validar Aclaraci√≥n -->
    <div id="modal-validar-aclaracion" class="modal">
      <div class="modal-overlay" onclick="cerrarModalValidarAclaracion()"></div>
      <div class="modal-dialog" style="max-width: 700px">
        <div class="modal-content">
          <div class="modal-header">
            <h2>‚úÖ Validar Aclaraci√≥n</h2>
            <button class="close-btn" onclick="cerrarModalValidarAclaracion()">
              √ó
            </button>
          </div>

          <form
            id="form-validar-aclaracion"
            onsubmit="validarAclaracion(event)"
          >
            <div class="modal-body">
              <input type="hidden" id="validar-aclaracion-id" />

              <div
                class="info-box"
                style="
                  background: #f0f8ff;
                  padding: 15px;
                  border-radius: 8px;
                  margin-bottom: 20px;
                "
              >
                <h3 style="margin-top: 0; color: #0066cc">
                  üìã Informaci√≥n del Campo
                </h3>
                <p>
                  <strong>Reporte:</strong>
                  <span id="validar-reporte-codigo"></span>
                </p>
                <p>
                  <strong>Campo:</strong>
                  <span id="validar-nombre-campo"></span>
                </p>
              </div>

              <div class="form-group">
                <label><strong>‚ùì Pregunta de la IA:</strong></label>
                <div
                  id="validar-pregunta-ia"
                  style="
                    background: #fff3cd;
                    padding: 10px;
                    border-radius: 5px;
                    margin-top: 5px;
                  "
                ></div>
              </div>

              <div class="form-group">
                <label><strong>üí¨ Respuesta del Usuario:</strong></label>
                <div
                  id="validar-respuesta-usuario"
                  style="
                    background: #d1ecf1;
                    padding: 10px;
                    border-radius: 5px;
                    margin-top: 5px;
                  "
                ></div>
                <p style="font-size: 0.9em; color: #666; margin-top: 5px">
                  Por: <span id="validar-usuario"></span> ‚Ä¢
                  <span id="validar-fecha"></span>
                </p>
              </div>

              <div class="form-group">
                <label for="validar-respuesta-final">
                  <strong>‚úèÔ∏è Tu Respuesta (Admin):</strong>
                </label>
                <textarea
                  id="validar-respuesta-final"
                  class="form-control"
                  rows="4"
                  placeholder="Puedes aprobar la respuesta del usuario o mejorarla..."
                  required
                  style="resize: vertical"
                ></textarea>
                <p style="font-size: 0.9em; color: #666; margin-top: 5px">
                  üí° Esta respuesta se guardar√° en la base de conocimiento para
                  mejorar futuras validaciones de IA
                </p>
              </div>

              <div class="form-group">
                <label>
                  <input type="checkbox" id="validar-aprobar" checked />
                  Aprobar y agregar a base de conocimiento
                </label>
              </div>
            </div>

            <div class="modal-footer">
              <button
                type="button"
                class="btn btn-secondary"
                onclick="cerrarModalValidarAclaracion()"
              >
                Cancelar
              </button>
              <button type="submit" class="btn btn-success">
                ‚úÖ Validar y Guardar
              </button>
            </div>
          </form>
        </div>
      </div>
    </div>

    <script src="/static/admin.js?v=3"></script>
  </body>
</html>
